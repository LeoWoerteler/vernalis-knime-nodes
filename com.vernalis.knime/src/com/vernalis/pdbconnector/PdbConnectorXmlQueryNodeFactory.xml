<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE knimeNode PUBLIC "-//UNIKN//DTD KNIME Node 2.0//EN" "http://www.knime.org/Node.dtd">
<knimeNode icon="./pdb_xml.png" type="Source">
    <name>PDB Connector (XML Query String)</name>
    
    <shortDescription>
        Source node to connect to RCSB PDB RESTful Web Services for advanced search and custom reporting.
    </shortDescription>
    
    <fullDescription>
        <intro><p>The <i>PDB Connector (XML Query String)</i> node provides connections to two RESTful Web Services for search and retrieval of information from the Protein Data Bank:
            <ul>
                <li>Advanced Search (http://www.rcsb.org/pdb/rest/search)</li>
                <li>Custom Report (http://www.rcsb.org/pdb/rest/customReport)</li>
            </ul>
        </p>
            <p>The user interface dialog options are designed to be a close mimic of the interactive reporting options provided at
                <a href="http://www.pdb.org/pdb/search/advSearch.do">http://www.pdb.org/pdb/search/advSearch.do</a> and the user
                is encouraged to explore this resource for a full explanation of each search option.  The query is entered as a single XML string
                in this node (For a user-friendly query builder version, see the original <i>PDB Connector</i> node).  This query can be copied
                and pasted from the "Query Details" link on a PDB query results page at the <a href="http://www.rcsb.org">RCSB PDB</a>.  
                The XML Query is made available as a flow variable (<i>xmlQuery</i>) after node execution.</p>
            <p>The node also allows for simple generation of a second report format table from a query run in either this or the <i>PDB Connector</i> node, as
            both nodes provide the query xml as a flow variable at the output ports.</p>
            <p>The node provides options to use either POST or GET report webservice variants.  The POST option is newer, and should be used unless machine memory is an issue 
            	(The node will download the entire report to memory).  The GET service requires multiple requests of the webservice, and URL length limits the number of hits which 
            	can be processed in each call, and the number of available report fields.  Lower values for the maximum URL length (2000-8000) will result in more calls, and fewer 
            	fields being available, but is more reliable when running through a proxy server.  Higher values should be used where possible.  Multiple calls to the GET service
            	are likely to be intercepted by the PDB server "Robot Blocker", adding further time to the query.  The GET service should be avoided wherever possible.  
            	The node will make a number of retries at increasing delay intervals (0, 1, 5, 10, 30, 60, 300, 600 seconds) to download each block of report 
            	data during the second part of the execution (There is an additional delay, defaulting to 1 second, on each attempt, which can be adjusted by 
            	adding the line -Dknime.url.timeout= followed by a value in milliseconds - e.g. 5000 for 5 seconds to the knime.ini file).</p>
            <p>The <i>PDB Connector (XML Query String)</i> node was developed by <a href="http://www.vernalis.com/">Vernalis (Cambridge, UK)</a>, based on the original 
            	<i>PDB Connector</i> node developed by <a href="http://www.enspiral-discovery.com/">Enspiral Discovery</a> in collaboration with
                <a href="http://www.vernalis.com/">Vernalis (Cambridge, UK)</a>.
                For feedback and more information, please contact <a href="mailto:knime@vernalis.com">knime@vernalis.com</a>
                </p>
        </intro>
        <option name="Query Options">Master query tab. Use this tab to:
            <ul>
                <li>Control the (optional) sequence similarity filter, used to remove similar sequences from the search hits.</li>
                <li>Control the composite query logic (individual query options can be either ANDed or ORed together).</li>
                <li>Select the ligand image size to use in the generation of ligand image URLs (applies to Ligand Image field only).</li>
                <li>Clear all query options.</li>
                <li>Test the current query, with display of xml query string and result count.  If a flow variable has been specified for the xml query, it's 
                	value will be used in the test. (NB This behaviour is different from that in the <i>PDB Connector</i> node, where the 'Test' button uses 
                	the query configured in the dialog, without reference to flow variable settings.)</li>
                <li>Select the POST or GET service.  GET is older, but may limit number of report fields which can be returned, and is slower.  If using the GET
                option, the maximum URL length can be set between 2000 and 8000.  Higher values allow more fields to be returned, and result in fewer calls to 
                the webservice, but may fall foul of proxy servers.  The use of the POST service is recommended unless machine memory is a major issue.</li>
            </ul>
        </option>
        <option name="Report Options">Master reporting tab, to control the selection of custom report fields in OutPort1.
            <ul>
                <li>Use the dropdown menu to select from a number of predefined standard reports</li>
                <li>Or select Customizable Table to allow fine-grained selection of all custom report fields.</li>
                <li>Use Select All to initialise a Customizable Table with all report fields.</li>
                <li>Use Clear All to initialise a Customizable Table with no report fields.</li>
            </ul>
        </option>
        
        
    </fullDescription>
    
    <ports>
    	<inPort index="0" name="Flow Variables (Optional)">Optional flow variable connection, which could contain the XML query in a flow variable</inPort>
        <outPort index="0" name="PDB IDs">One-column table of PDB IDs that match query</outPort>
        <outPort index="1" name="Custom report table">Custom report fields.</outPort>
    </ports>    
</knimeNode>
